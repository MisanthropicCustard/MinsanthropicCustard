'use strict';

// require('babel-register');

var env = process.env;
var NODE_ENV = process.env.NODE_ENV;
var isDev = NODE_ENV === 'development';
var isTest = NODE_ENV === 'test';

var webpack = require('webpack');
var marked = require('marked');
var fs = require('fs');
var path = require('path'),
    join = path.join,
    resolve = path.resolve;

var root = resolve(__dirname);
var src = join(root, 'src');
var examples = join(root, 'examples');
var modules = join(root, 'node_modules');
var dest = join(root, 'public');

var getConfig = require('hjs-webpack');

var config = getConfig({
  isDev: isDev,
  in: join(examples, 'index.js'),
  out: dest,
  clearBeforeBuild: true,
  html: function html(context, cb) {
    context.publicPath = isDev ? 'http://localhost:3000/' : '';

    fs.readFile(join(root, 'README.md'), function (err, data) {
      if (err) {
        return cb(err);
      }
      cb(null, {
        'index.html': context.defaultTemplate()
      });
    });
  }
});

var dotenv = require('dotenv');
var envVariables = dotenv.config();

// Converts keys to be surrounded with __
var defines = Object.keys(envVariables).reduce(function (memo, key) {
  var val = JSON.stringify(envVariables[key]);
  memo['__' + key.toUpperCase() + '__'] = val;
  return memo;
}, {
  __NODE_ENV__: JSON.stringify(env.NODE_ENV),
  __IS_DEV__: isDev
});

config.externals = {
  'window.google': true
};

// Setup css modules require hook so it works when building for the server
var cssModulesNames = (isDev ? '[path][name]__[local]__' : '') + '[hash:base64:5]';
var matchCssLoaders = /(^|!)(css-loader)($|!)/;

var findLoader = function findLoader(loaders, match, fn) {
  var found = loaders.filter(function (l) {
    return l && l.loader && l.loader.match(match);
  });
  return found ? found[0] : null;
};

var cssloader = findLoader(config.module.loaders, matchCssLoaders);
var newloader = Object.assign({}, cssloader, {
  test: /\.module\.css$/,
  include: [src, examples],
  loader: cssloader.loader.replace(matchCssLoaders, '$1$2?modules&localIdentName=' + cssModulesNames + '$3')
});
config.module.loaders.push(newloader);
cssloader.test = new RegExp('[^module]' + cssloader.test.source);
cssloader.loader = 'style!css!postcss';

cssloader.include = [src, examples];

config.module.loaders.push({
  test: /\.css$/,
  include: [modules],
  loader: 'style!css'
});

config.plugins = [new webpack.DefinePlugin(defines)].concat(config.plugins);

config.postcss = [].concat([require('precss')({}), require('autoprefixer')({}), require('cssnano')({})]);

module.exports = config;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3dlYnBhY2suY29uZmlnLmpzIl0sIm5hbWVzIjpbImVudiIsInByb2Nlc3MiLCJOT0RFX0VOViIsImlzRGV2IiwiaXNUZXN0Iiwid2VicGFjayIsInJlcXVpcmUiLCJtYXJrZWQiLCJmcyIsInBhdGgiLCJqb2luIiwicmVzb2x2ZSIsInJvb3QiLCJfX2Rpcm5hbWUiLCJzcmMiLCJleGFtcGxlcyIsIm1vZHVsZXMiLCJkZXN0IiwiZ2V0Q29uZmlnIiwiY29uZmlnIiwiaW4iLCJvdXQiLCJjbGVhckJlZm9yZUJ1aWxkIiwiaHRtbCIsImNvbnRleHQiLCJjYiIsInB1YmxpY1BhdGgiLCJyZWFkRmlsZSIsImVyciIsImRhdGEiLCJkZWZhdWx0VGVtcGxhdGUiLCJkb3RlbnYiLCJlbnZWYXJpYWJsZXMiLCJkZWZpbmVzIiwiT2JqZWN0Iiwia2V5cyIsInJlZHVjZSIsIm1lbW8iLCJrZXkiLCJ2YWwiLCJKU09OIiwic3RyaW5naWZ5IiwidG9VcHBlckNhc2UiLCJfX05PREVfRU5WX18iLCJfX0lTX0RFVl9fIiwiZXh0ZXJuYWxzIiwiY3NzTW9kdWxlc05hbWVzIiwibWF0Y2hDc3NMb2FkZXJzIiwiZmluZExvYWRlciIsImxvYWRlcnMiLCJtYXRjaCIsImZuIiwiZm91bmQiLCJmaWx0ZXIiLCJsIiwibG9hZGVyIiwiY3NzbG9hZGVyIiwibW9kdWxlIiwibmV3bG9hZGVyIiwiYXNzaWduIiwidGVzdCIsImluY2x1ZGUiLCJyZXBsYWNlIiwicHVzaCIsIlJlZ0V4cCIsInNvdXJjZSIsInBsdWdpbnMiLCJEZWZpbmVQbHVnaW4iLCJjb25jYXQiLCJwb3N0Y3NzIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFFQSxJQUFNQSxNQUFNQyxRQUFRRCxHQUFwQjtBQUNBLElBQU1FLFdBQVdELFFBQVFELEdBQVIsQ0FBWUUsUUFBN0I7QUFDQSxJQUFNQyxRQUFTRCxhQUFhLGFBQTVCO0FBQ0EsSUFBTUUsU0FBU0YsYUFBYSxNQUE1Qjs7QUFFQSxJQUFNRyxV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LE1BQVYsQ0FBaUJPLE9BQWpCLENBQXlCZixlQUF6QixtQ0FBeUVELGVBQXpFO0FBSHFDLENBQTdCLENBQWxCO0FBS0EzQixPQUFPc0MsTUFBUCxDQUFjUixPQUFkLENBQXNCYyxJQUF0QixDQUEyQkwsU0FBM0I7QUFDQUYsVUFBVUksSUFBVixHQUFpQixJQUFJSSxNQUFKLGVBQXVCUixVQUFVSSxJQUFWLENBQWVLLE1BQXRDLENBQWpCO0FBQ0FULFVBQVVELE1BQVYsR0FBbUIsbUJBQW5COztBQUVBQyxVQUFVSyxPQUFWLEdBQW9CLENBQUMvQyxHQUFELEVBQU1DLFFBQU4sQ0FBcEI7O0FBRUFJLE9BQU9zQyxNQUFQLENBQWNSLE9BQWQsQ0FBc0JjLElBQXRCLENBQTJCO0FBQ3pCSCxRQUFNLFFBRG1CO0FBRXpCQyxXQUFTLENBQUM3QyxPQUFELENBRmdCO0FBR3pCdUMsVUFBUTtBQUhpQixDQUEzQjs7QUFPQXBDLE9BQU8rQyxPQUFQLEdBQWlCLENBQ2YsSUFBSTdELFFBQVE4RCxZQUFaLENBQXlCbEMsT0FBekIsQ0FEZSxFQUVmbUMsTUFGZSxDQUVSakQsT0FBTytDLE9BRkMsQ0FBakI7O0FBSUEvQyxPQUFPa0QsT0FBUCxHQUFpQixHQUFHRCxNQUFILENBQVUsQ0FDekI5RCxRQUFRLFFBQVIsRUFBa0IsRUFBbEIsQ0FEeUIsRUFFekJBLFFBQVEsY0FBUixFQUF3QixFQUF4QixDQUZ5QixFQUd6QkEsUUFBUSxTQUFSLEVBQW1CLEVBQW5CLENBSHlCLENBQVYsQ0FBakI7O0FBTUFtRCxPQUFPYSxPQUFQLEdBQWlCbkQsTUFBakIiLCJmaWxlIjoid2VicGFjay5jb25maWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyByZXF1aXJlKCdiYWJlbC1yZWdpc3RlcicpO1xuXG5jb25zdCBlbnYgPSBwcm9jZXNzLmVudjtcbmNvbnN0IE5PREVfRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG5jb25zdCBpc0RldiAgPSBOT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcbmNvbnN0IGlzVGVzdCA9IE5PREVfRU5WID09PSAndGVzdCc7XG5cbmNvbnN0IHdlYnBhY2sgPSByZXF1aXJlKCd3ZWJwYWNrJyk7XG5jb25zdCBtYXJrZWQgID0gcmVxdWlyZSgnbWFya2VkJyk7XG5jb25zdCBmcyAgICAgID0gcmVxdWlyZSgnZnMnKTtcbmNvbnN0IHBhdGggICAgPSByZXF1aXJlKCdwYXRoJyksXG4gICAgICBqb2luICAgID0gcGF0aC5qb2luLFxuICAgICAgcmVzb2x2ZSA9IHBhdGgucmVzb2x2ZTtcblxuY29uc3Qgcm9vdCAgPSByZXNvbHZlKF9fZGlybmFtZSk7XG5jb25zdCBzcmMgICA9IGpvaW4ocm9vdCwgJ3NyYycpO1xuY29uc3QgZXhhbXBsZXMgPSBqb2luKHJvb3QsICdleGFtcGxlcycpO1xuY29uc3QgbW9kdWxlcyA9IGpvaW4ocm9vdCwgJ25vZGVfbW9kdWxlcycpO1xuY29uc3QgZGVzdCAgPSBqb2luKHJvb3QsICdwdWJsaWMnKTtcblxuY29uc3QgZ2V0Q29uZmlnID0gcmVxdWlyZSgnaGpzLXdlYnBhY2snKVxuXG52YXIgY29uZmlnID0gZ2V0Q29uZmlnKHtcbiAgaXNEZXYsXG4gIGluOiBqb2luKGV4YW1wbGVzLCAnaW5kZXguanMnKSxcbiAgb3V0OiBkZXN0LFxuICBjbGVhckJlZm9yZUJ1aWxkOiB0cnVlLFxuICBodG1sOiBmdW5jdGlvbihjb250ZXh0LCBjYikge1xuICAgIGNvbnRleHQucHVibGljUGF0aCA9IGlzRGV2ID8gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC8nIDogJydcblxuICAgIGZzLnJlYWRGaWxlKGpvaW4ocm9vdCwgJ1JFQURNRS5tZCcpLCAoZXJyLCBkYXRhKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgfVxuICAgICAgY2IobnVsbCwge1xuICAgICAgICAnaW5kZXguaHRtbCc6IGNvbnRleHQuZGVmYXVsdFRlbXBsYXRlKCksXG4gICAgICAgIC8vICdyZWFkbWUuaHRtbCc6IGNvbnRleHQuZGVmYXVsdFRlbXBsYXRlKHtcbiAgICAgICAgLy8gICBodG1sOiBgPGRpdiBpZD1cInJlYWRtZVwiPlxuICAgICAgICAvLyAgICAgICAgICAgJHttYXJrZWQoZGF0YS50b1N0cmluZygndXRmLTgnKSl9XG4gICAgICAgIC8vICAgICAgICAgPC9kaXY+YCxcbiAgICAgICAgLy8gICBtZXRhVGFnczoge1xuICAgICAgICAvLyAgICAgYm9vdEFwcDogZmFsc2VcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vIH0pXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbn0pO1xuXG5jb25zdCBkb3RlbnYgICAgICA9IHJlcXVpcmUoJ2RvdGVudicpO1xuY29uc3QgZW52VmFyaWFibGVzID0gZG90ZW52LmNvbmZpZygpO1xuXG4vLyBDb252ZXJ0cyBrZXlzIHRvIGJlIHN1cnJvdW5kZWQgd2l0aCBfX1xuY29uc3QgZGVmaW5lcyA9XG4gIE9iamVjdC5rZXlzKGVudlZhcmlhYmxlcylcbiAgLnJlZHVjZSgobWVtbywga2V5KSA9PiB7XG4gICAgY29uc3QgdmFsID0gSlNPTi5zdHJpbmdpZnkoZW52VmFyaWFibGVzW2tleV0pO1xuICAgIG1lbW9bYF9fJHtrZXkudG9VcHBlckNhc2UoKX1fX2BdID0gdmFsO1xuICAgIHJldHVybiBtZW1vO1xuICB9LCB7XG4gICAgX19OT0RFX0VOVl9fOiBKU09OLnN0cmluZ2lmeShlbnYuTk9ERV9FTlYpLFxuICAgIF9fSVNfREVWX186IGlzRGV2XG4gIH0pXG5cblxuY29uZmlnLmV4dGVybmFscyA9IHtcbiAgJ3dpbmRvdy5nb29nbGUnOiB0cnVlXG59XG5cbi8vIFNldHVwIGNzcyBtb2R1bGVzIHJlcXVpcmUgaG9vayBzbyBpdCB3b3JrcyB3aGVuIGJ1aWxkaW5nIGZvciB0aGUgc2VydmVyXG5jb25zdCBjc3NNb2R1bGVzTmFtZXMgPSBgJHtpc0RldiA/ICdbcGF0aF1bbmFtZV1fX1tsb2NhbF1fXycgOiAnJ31baGFzaDpiYXNlNjQ6NV1gO1xuY29uc3QgbWF0Y2hDc3NMb2FkZXJzID0gLyhefCEpKGNzcy1sb2FkZXIpKCR8ISkvO1xuXG5jb25zdCBmaW5kTG9hZGVyID0gKGxvYWRlcnMsIG1hdGNoLCBmbikgPT4ge1xuICBjb25zdCBmb3VuZCA9IGxvYWRlcnMuZmlsdGVyKGwgPT4gbCAmJiBsLmxvYWRlciAmJiBsLmxvYWRlci5tYXRjaChtYXRjaCkpXG4gIHJldHVybiBmb3VuZCA/IGZvdW5kWzBdIDogbnVsbDtcbn1cblxuY29uc3QgY3NzbG9hZGVyID0gZmluZExvYWRlcihjb25maWcubW9kdWxlLmxvYWRlcnMsIG1hdGNoQ3NzTG9hZGVycyk7XG5jb25zdCBuZXdsb2FkZXIgPSBPYmplY3QuYXNzaWduKHt9LCBjc3Nsb2FkZXIsIHtcbiAgdGVzdDogL1xcLm1vZHVsZVxcLmNzcyQvLFxuICBpbmNsdWRlOiBbc3JjLCBleGFtcGxlc10sXG4gIGxvYWRlcjogY3NzbG9hZGVyLmxvYWRlci5yZXBsYWNlKG1hdGNoQ3NzTG9hZGVycywgYCQxJDI/bW9kdWxlcyZsb2NhbElkZW50TmFtZT0ke2Nzc01vZHVsZXNOYW1lc30kM2ApXG59KVxuY29uZmlnLm1vZHVsZS5sb2FkZXJzLnB1c2gobmV3bG9hZGVyKTtcbmNzc2xvYWRlci50ZXN0ID0gbmV3IFJlZ0V4cChgW15tb2R1bGVdJHtjc3Nsb2FkZXIudGVzdC5zb3VyY2V9YClcbmNzc2xvYWRlci5sb2FkZXIgPSAnc3R5bGUhY3NzIXBvc3Rjc3MnXG5cbmNzc2xvYWRlci5pbmNsdWRlID0gW3NyYywgZXhhbXBsZXNdO1xuXG5jb25maWcubW9kdWxlLmxvYWRlcnMucHVzaCh7XG4gIHRlc3Q6IC9cXC5jc3MkLyxcbiAgaW5jbHVkZTogW21vZHVsZXNdLFxuICBsb2FkZXI6ICdzdHlsZSFjc3MnXG59KTtcblxuXG5jb25maWcucGx1Z2lucyA9IFtcbiAgbmV3IHdlYnBhY2suRGVmaW5lUGx1Z2luKGRlZmluZXMpXG5dLmNvbmNhdChjb25maWcucGx1Z2lucyk7XG5cbmNvbmZpZy5wb3N0Y3NzID0gW10uY29uY2F0KFtcbiAgcmVxdWlyZSgncHJlY3NzJykoe30pLFxuICByZXF1aXJlKCdhdXRvcHJlZml4ZXInKSh7fSksXG4gIHJlcXVpcmUoJ2Nzc25hbm8nKSh7fSlcbl0pXG5cbm1vZHVsZS5leHBvcnRzID0gY29uZmlnO1xuIl19